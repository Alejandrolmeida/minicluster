# Configuración de dnsmasq para RPI-02 Gateway
# Minicluster - Gateway/DHCP/DNS Server
# Última actualización: Febrero 2026

# Interface de escucha (red LAN del cluster)
interface=eth0

# No escuchar en otras interfaces
bind-interfaces

# Dominio local del cluster
domain=cluster.local

# Expandir nombres simples con el dominio
expand-hosts

# Rango DHCP para los nodos del cluster
# Red: 192.168.50.0/24
# Gateway: 192.168.50.1 (rpi-02)
# Rango dinámico: .50-.150
# Lease: 12 horas
dhcp-range=192.168.50.50,192.168.50.150,12h

# Opciones DHCP
dhcp-option=option:router,192.168.50.1        # Gateway
dhcp-option=option:dns-server,192.168.50.1    # DNS Server (este mismo)
dhcp-option=option:ntp-server,192.168.50.1    # NTP Server (opcional)

# IPs estáticas para nodos del cluster (ver cluster.hosts)
# Se definen en /etc/dnsmasq.d/cluster.hosts

# Archivo adicional de hosts estáticos
addn-hosts=/etc/dnsmasq.d/cluster.hosts

# Tamaño de la cache DNS
cache-size=1000

# No reenviar nombres simples (sin dominio)
domain-needed

# No reenviar nombres en rangos privados
bogus-priv

# DNS upstream servers
# Se usarán los configurados en /etc/resolv.conf por systemd-resolved
# O se pueden definir explícitamente:
# server=8.8.8.8
# server=8.8.4.4
# server=1.1.1.1

# Logs (comentar en producción para reducir writes a SD)
# log-queries
# log-dhcp

# Archivo de leases DHCP
dhcp-leasefile=/var/lib/misc/dnsmasq.leases

# DHCP authoritative (este es el único servidor DHCP en la red)
dhcp-authoritative

# No leer /etc/hosts
# no-hosts

# No leer /etc/resolv.conf (usar solo los servers definidos arriba)
# no-resolv

# Enviar información DHCP al log
# log-facility=/var/log/dnsmasq.log
